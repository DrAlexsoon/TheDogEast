#BTREE
- 分支因子：一个页面对子页面的引用数量
将数据分解成固定大小的块和页面，大多数数据库放入一个三到四层BTREE，
BTREE,底层操作用新数据覆盖磁盘上的页面,为了防止插入过程中出现页面拆分，引用更新。采用了**WAL(write-head-log/redo-log)** 用来是BTree恢复到一致性状态，通过寄存器锁来实现并发控制(locak/latch)[1]
##优化
- 一些DBMS使用COPY-ON-WRITE,而不是通过WAL来进行崩溃恢复
- 通过不存储全部键值来节省空间
- B+tree 额外添加指针，左右两边
#B树 VS LSM树
LSM写入性能更好，而B读取性能更好
优点
- B树索引至少两次写入数据(redo log/页本身) 相比B树有较低的写放大(warte amplification)
- LSM树可以被更好的压缩，B树中由于引擎会存在被分割未使用的空间
缺点
- 压缩过程中会干扰正常的读写操作
- 出现在高写入吞吐量，如果压缩跟不上写入速率，读取所读也会缓慢
- 日志结构化存储引擎在不同段(semagent)中有多个副本，在很多关系型数据库在键范围上加锁实现事物隔离
#其他索引结构
##二级索引主要的不同是键不是唯一的，可以通过两种方式解决
- 1.通过索引中的的每个值，成为匹配行，(全文索引)
- 2.向索引添加行标识符使每个关键词唯一
##聚簇索引/非聚簇索引/多列索引(覆盖索引)
聚簇索引，覆盖索引通过牺牲空间和写入性能来提供更高的读写性能
[36]hyperDex 多维索引
##全文搜索模糊索引
Lucence使用了SSTable的结构，内存中的索引是键中字符有限的状态机[38]trie
#OLTP(Online Transaction Processing)ONAP(Online Analytice Processing)
- OLTP: 事物不一定是ACID,意味着允许客户端进行低延迟的读取和写入，而不是批量
- OLAP: 数据仓库(data warehose)将数据加入仓库的过程为(抽取-转换-加载)ETL,定时抽取/流式写入 
##星型(在模式的中心是一个事实表)|雪花型|列存储
通常需要访问大量的行，而仅仅需要其中的几列，为了处理这样的查询,查询只需要解析使用了哪些列
- 列压缩:对于每一列而言重复数据很多，根据位图来进行压缩 **bigTable**中将一行中所有的列与行一起存储，不能使用压缩


#JSON|XML|CSV
- XML,CSV无法区分字符串或数字，JSON可以区分，但不区分整形，浮点而且无法指定精度
- uniCode,因无法指定charset，可以通过base64进行转码，但增加了33%数据
- CVS没有任何模式，需要应用程序指定行和列的含义
#二进制编码
面对TB级别的数据，衍生出二进制编码格式JSON(MessagePack ,BSON,BJSON,UBJSON,BISON,SIMLE)
##**Thritf**[15]|**Protcol Buffers**[16]
Thritf使用模式定义通过字段标签，通过单个字节来表示整形1个字节表示[-64,63]
- 向前兼容，通过忽略不能解析的数据类型；向后兼容,如果新增类型是必须的,需要指定默认值
##**AVRO**[20](阿夫罗)
紧凑的二进制数据，仅在字段后面增加一个字节的表示编码类型，作者模式和读者模式
- 大文件:文件作者可以在文件的开头包含一次作者模式
- 独立写入的数据库:在编码记录的开始包含一个版本号，并保存模式版本列表Espresso[23]
- 通过网路链接: 可以在链接设置上协商模式版本
代码生成和动态类型语言
Thritf和Protcol Buffer依赖代码生成，定义模式后可以通过编程语言解析；
AVRO为静态语言提供可选代码生成，也可以在不生成代码的情况下使用 Apache Pig
#数据流
- **数据库**，1.在滚动升级的过程中，旧版本读取新版本数据写会会存在数据丢失
- **服务流**: 两种流行的WEB服务方法：rest/soap;RPC根本的缺陷，**本地函数是可预测的**1.本地函数要么成功，要么抛出异常/永不返回，网络会产生超时 2.本地函数耗时大致相同，rpc受到网络环境影响 
3.本地函数数据传递通过指针，在网络中大对象会变成严重的问题
    - REST:不是一种协议，而是基于HTTP的设计哲学
    - SOAP:使用WEB服务描述语言(WSDL)基于xml来描述
新的RPC框架更明确的是，强调远程请求和本地调用区别，futrue和流的支持，使用二进制rpc框架会有更好的性能，Restful公共API的设计风格，而RPC同一数据中心的
- **消息流**:相比RPC的优点 1.如果收件人不可用或过载，可以充当缓冲区，提高可靠性 2.避免消息丢失 3.不需要知道收件人的IP和端口号，4.可以实现多播 5.收件人与发件人隔离
#分布式的ACTOR框架
实际是将消息代理和角色模型集中到一个框架中
#共识算法
- VSR
- Paxos
- raft
- zab
全序广播,进行

[1]: https://stackoverflow.com/questions/3111403/what-is-the-difference-between-a-lock-and-a-latch-in-the-context-of-concurrent-a